#!/usr/bin/env node
var path=require("path"),os=require("os"),stdin=process.stdin,execSync=require("child_process").execSync,clear=require("clear"),prompt=require("prompt"),fse=require("fs-extra"),args=process.argv,suppliedRelativeConfigPath=args[2],defaultConfigFilePath=path.resolve(os.homedir(),"myterminal-configs.json"),myterminalCliCompanion=function(){var n,e=[],o=function(){fse.copySync(path.resolve(__dirname,"../examples/configs.json"),defaultConfigFilePath,{overwrite:!1})},t=function(e){n=e},i=function(){r(),f()},r=function(){c(),a(),s()},c=function(){clear(),console.log("** myterminal-cli **\n")},a=function(){var o=e.map(function(n,o){return e.slice(0,o+1)}).map(function(e,o){return e.reduce(function(n,e){return n.commands[e]},n)}).map(function(n){return n.title});console.log([n.title].concat(o).join(" -> ")+"\n")},s=function(){var e=l();u().forEach(function(n){console.log(n+": "+e.commands[n].title)}),e!==n?console.log("\nq: Go back...\n"):console.log("\nq: Quit\n")},l=function(){return e.length?e.reduce(function(n,e){return n.commands[e]},n):n},u=function(){return Object.keys(l().commands)},f=function(){p(),stdin.on("data",d)},m=function(){stdin.removeListener("data",d)},p=function(){stdin.setRawMode(!0),stdin.resume(),stdin.setEncoding("utf8")},d=function(n){if(m(),""===n)y();else if("q"===n)e.length||y(),e.pop(),i();else if(u().indexOf(n)>-1){var o=g(n),t=o.task;t?(r(),h(o)):(e.push(n),i())}else i()},g=function(o){return e.length?e.reduce(function(n,e){return n.commands[e]},n).commands[o]:n.commands[o]},h=function(n){console.log("Executing command:",n.title,"\n"),console.log("---------------------------------------"),n.params?v(n):C(n.task)},C=function(n){try{execSync(n,{stdio:[0,1,2]})}catch(n){}console.log("---------------------------------------\n"),f()},v=function(n){prompt.start(),prompt.get(n.params,function(e,o){var t=[n.task].concat(n.params.map(function(e,t){return o[n.params[t]]})).join(" ");C(t)})},y=function(){clear(),process.exit()};return{copyConfigFileIfNotPresent:o,setConfigs:t,showNextScreen:i}}();prompt.message="Enter the value for ",prompt.delimiter="";var absoluteConfigPath=suppliedRelativeConfigPath?path.resolve(process.cwd(),suppliedRelativeConfigPath):defaultConfigFilePath;myterminalCliCompanion.copyConfigFileIfNotPresent(),myterminalCliCompanion.setConfigs(require(absoluteConfigPath)),myterminalCliCompanion.showNextScreen();