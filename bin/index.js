#!/usr/bin/env node
var path=require("path"),os=require("os"),stdin=process.stdin,execSync=require("child_process").execSync,version=require("../package.json").version,prompt=require("prompt"),clear=require("clear"),chalk=require("chalk"),fse=require("fs-extra"),args=process.argv,suppliedRelativeConfigPath=args[2],defaultConfigFilePath=path.resolve(os.homedir(),"myterminal-configs.json"),myterminalCliCompanion=function(){var n,e=[],o=function(){fse.copySync(path.resolve(__dirname,"../examples/configs.json"),defaultConfigFilePath,{overwrite:!1})},t=function(e){n=e},r=function(){i(),m()},i=function(){a(),s(),l()},a=function(){var n=c("myterminal-cli v"+version);clear(),console.log(chalk.inverse.cyan(y(" "))),console.log(chalk.inverse.cyan(n)),console.log(chalk.inverse.cyan(y(" "))+"\n")},c=function(n){var e=y(" ").length-n.length;return C(" ",Math.floor(e/2))+n+C(" ",Math.ceil(e/2))},s=function(){var o=e.map(function(n,o){return e.slice(0,o+1)}).map(function(e,o){return e.reduce(function(n,e){return n.commands[e]},n)}).map(function(n){return n.title});console.log(chalk.cyan([n.title].concat(o).join(" -> ")+"\n"))},l=function(){var e=u();f().forEach(function(n){console.log(chalk.yellow(n+": "+e.commands[n].title))}),e!==n?console.log(chalk.red("\nq: Go back...")+"\n"):console.log(chalk.red("\nq: Quit")+"\n")},u=function(){return e.length?e.reduce(function(n,e){return n.commands[e]},n):n},f=function(){return Object.keys(u().commands)},m=function(){h(),stdin.on("data",d)},p=function(){stdin.removeListener("data",d)},h=function(){stdin.setRawMode(!0),stdin.resume(),stdin.setEncoding("utf8")},d=function(n){if(p(),""===n)j();else if("q"===n)e.length||j(),e.pop(),r();else if(f().indexOf(n)>-1){var o=g(n),t=o.task;t?(i(),v(o)):(e.push(n),r())}else r()},g=function(o){return e.length?e.reduce(function(n,e){return n.commands[e]},n).commands[o]:n.commands[o]},v=function(n){console.log(chalk.inverse.green(c("Command: "+n.title))+"\n"),n.params?q(n):k(n.task)},y=function(n){return new Array(process.stdout.columns-1).join(",").split(",").map(function(){return n}).join("")},C=function(n,e){return new Array(e).join(",").split(",").map(function(){return n}).join("")},k=function(n){try{execSync(n,{stdio:[0,1,2]})}catch(n){}console.log("\n"+chalk.green(y("-"))),m()},q=function(n){prompt.start(),prompt.get(n.params,function(e,o){var t=[n.task].concat(n.params.map(function(e,t){return o[n.params[t]]})).join(" ");k(t)})},j=function(){clear(),process.exit()};return{copyConfigFileIfNotPresent:o,setConfigs:t,showNextScreen:r}}();prompt.message="Enter the value for ",prompt.delimiter="";var absoluteConfigPath=suppliedRelativeConfigPath?path.resolve(process.cwd(),suppliedRelativeConfigPath):defaultConfigFilePath;myterminalCliCompanion.copyConfigFileIfNotPresent(),myterminalCliCompanion.setConfigs(require(absoluteConfigPath)),myterminalCliCompanion.showNextScreen();